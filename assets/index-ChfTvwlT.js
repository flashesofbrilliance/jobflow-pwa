(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function t(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(d){if(d.ep)return;d.ep=!0;const u=t(d);fetch(d.href,u)}})();const Ge=(e,n)=>n.some(t=>e instanceof t);let _e,ve;function ze(){return _e||(_e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xe(){return ve||(ve=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ke=new WeakMap,ae=new WeakMap,xe=new WeakMap,ee=new WeakMap,ce=new WeakMap;function Ye(e){const n=new Promise((t,l)=>{const d=()=>{e.removeEventListener("success",u),e.removeEventListener("error",m)},u=()=>{t(x(e.result)),d()},m=()=>{l(e.error),d()};e.addEventListener("success",u),e.addEventListener("error",m)});return n.then(t=>{t instanceof IDBCursor&&ke.set(t,e)}).catch(()=>{}),ce.set(n,e),n}function Ze(e){if(ae.has(e))return;const n=new Promise((t,l)=>{const d=()=>{e.removeEventListener("complete",u),e.removeEventListener("error",m),e.removeEventListener("abort",m)},u=()=>{t(),d()},m=()=>{l(e.error||new DOMException("AbortError","AbortError")),d()};e.addEventListener("complete",u),e.addEventListener("error",m),e.addEventListener("abort",m)});ae.set(e,n)}let se={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return ae.get(e);if(n==="objectStoreNames")return e.objectStoreNames||xe.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return x(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function et(e){se=e(se)}function tt(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...t){const l=e.call(te(this),n,...t);return xe.set(l,n.sort?n.sort():[n]),x(l)}:Xe().includes(e)?function(...n){return e.apply(te(this),n),x(ke.get(this))}:function(...n){return x(e.apply(te(this),n))}}function nt(e){return typeof e=="function"?tt(e):(e instanceof IDBTransaction&&Ze(e),Ge(e,ze())?new Proxy(e,se):e)}function x(e){if(e instanceof IDBRequest)return Ye(e);if(ee.has(e))return ee.get(e);const n=nt(e);return n!==e&&(ee.set(e,n),ce.set(n,e)),n}const te=e=>ce.get(e);function ot(e,n,{blocked:t,upgrade:l,blocking:d,terminated:u}={}){const m=indexedDB.open(e,n),f=x(m);return l&&m.addEventListener("upgradeneeded",p=>{l(x(m.result),p.oldVersion,p.newVersion,x(m.transaction),p)}),t&&m.addEventListener("blocked",p=>t(p.oldVersion,p.newVersion,p)),f.then(p=>{u&&p.addEventListener("close",()=>u()),d&&p.addEventListener("versionchange",b=>d(b.oldVersion,b.newVersion,b))}).catch(()=>{}),f}const rt=["get","getKey","getAll","getAllKeys","count"],at=["put","add","delete","clear"],ne=new Map;function Ee(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(ne.get(n))return ne.get(n);const t=n.replace(/FromIndex$/,""),l=n!==t,d=at.includes(t);if(!(t in(l?IDBIndex:IDBObjectStore).prototype)||!(d||rt.includes(t)))return;const u=async function(m,...f){const p=this.transaction(m,d?"readwrite":"readonly");let b=p.store;return l&&(b=b.index(f.shift())),(await Promise.all([b[t](...f),d&&p.done]))[0]};return ne.set(n,u),u}et(e=>({...e,get:(n,t,l)=>Ee(n,t)||e.get(n,t,l),has:(n,t)=>!!Ee(n,t)||e.has(n,t)}));const st="jobflow",ct=5,S="opportunities";let oe;async function v(){return oe||(oe=ot(st,ct,{upgrade(e,n){if(n<1){const t=e.createObjectStore(S,{keyPath:"id",autoIncrement:!0});t.createIndex("by_company_role",["company","role"]),t.createIndex("by_stage","stage"),t.createIndex("by_hash","hash",{unique:!0}),t.createIndex("by_stage_pos",["stage","pos"])}else{const t=e.transaction.objectStore(S);t.indexNames.contains("by_hash")||t.createIndex("by_hash","hash",{unique:!0}),t.indexNames.contains("by_stage_pos")||t.createIndex("by_stage_pos",["stage","pos"])}if(!e.objectStoreNames.contains("qualification_reviews")){const t=e.createObjectStore("qualification_reviews",{keyPath:"id",autoIncrement:!0});t.createIndex("by_opportunity","opportunityId"),t.createIndex("by_ts","ts")}if(!e.objectStoreNames.contains("events")){const t=e.createObjectStore("events",{keyPath:"id",autoIncrement:!0});t.createIndex("by_name","name"),t.createIndex("by_ts","ts")}if(n<4){if(!e.objectStoreNames.contains("contacts")){const t=e.createObjectStore("contacts",{keyPath:"id",autoIncrement:!0});t.createIndex("by_company","company"),t.createIndex("by_name","name")}if(!e.objectStoreNames.contains("companies")){const t=e.createObjectStore("companies",{keyPath:"id",autoIncrement:!0});t.createIndex("by_name","name"),t.createIndex("by_sector","sector")}if(!e.objectStoreNames.contains("activities")){const t=e.createObjectStore("activities",{keyPath:"id",autoIncrement:!0});t.createIndex("by_opportunity","opportunityId"),t.createIndex("by_ts","ts")}if(!e.objectStoreNames.contains("notes")){const t=e.createObjectStore("notes",{keyPath:"id",autoIncrement:!0});t.createIndex("by_opportunity","opportunityId"),t.createIndex("by_ts","ts")}}if(n<5){e.objectStoreNames.contains("config")||e.createObjectStore("config",{keyPath:"key"}),e.objectStoreNames.contains("planning")||e.createObjectStore("planning",{keyPath:"key"});const t=e.transaction.objectStore(S);t.indexNames.contains("by_deadline")||t.createIndex("by_deadline","deadline"),t.indexNames.contains("by_company")||t.createIndex("by_company","company")}}})),oe}async function it(){return(await v()).count(S)}async function lt(){const n=(await v()).transaction(S,"readwrite");await n.store.clear(),await n.done}function dt(e){return`${e.company||""}|${e.role||""}|${e.job_url||e.url||""}`}async function Q(e){const t=(await v()).transaction(S,"readwrite"),l={...e};l.stage||(l.stage="Research"),l.createdAt||(l.createdAt=new Date().toISOString()),typeof l.pos!="number"&&(l.pos=Date.now()),l.hash=dt(l);try{const d=await t.store.index("by_hash").getKey(l.hash);d?(l.id=d,await t.store.put(l)):await t.store.add(l)}finally{await t.done}}async function P(){return(await v()).getAll(S)}async function ut(e,n){const l=(await v()).transaction("qualification_reviews","readwrite"),d={opportunityId:e,ts:new Date().toISOString(),...n};await l.store.add(d),await l.done}async function mt(){return(await v()).getAll("qualification_reviews")}async function J(e,n){const l=(await v()).transaction("events","readwrite");await l.store.add({name:e,ts:new Date().toISOString(),data:n}),await l.done}async function re(e){return(await v()).transaction("events").store.index("by_name").getAll(e)}async function yt(){const e=await v(),[n,t,l,d,u]=await Promise.all([e.getAll(S),e.getAll("qualification_reviews"),e.getAll("events"),e.getAll("config"),e.getAll("planning")]);return{opportunities:n,qualification_reviews:t,events:l,config:d,planning:u}}const ft={key:"planning",targetDate:"",targetInterviews:5,callbacks:{cold:8,warm:40,strong:60},weeklyProgress:{cold:0,warm:0},lastRolloverIso:""};async function k(){return await(await v()).get("planning","planning")||{...ft}}async function $(e){const n=await v(),l={...await k(),...e,key:"planning"};return await n.put("planning",l),l}async function pt(e=new Date){const n=await k(),t=n.lastRolloverIso?new Date(n.lastRolloverIso):null,l=m=>{const f=new Date(m),p=(f.getDay()+6)%7;return f.setHours(0,0,0,0),f.setDate(f.getDate()-p),f},d=l(e).toISOString(),u=t?l(t).toISOString():"";return d!==u&&(n.weeklyProgress={cold:0,warm:0},n.lastRolloverIso=e.toISOString(),await $(n)),n}function wt(e){if(e==null)return 50;const n=Number(e);return Number.isNaN(n)?50:n<=5?Math.max(0,Math.min(100,(n-1)/4*100)):Math.max(0,Math.min(100,n))}function gt(e){var T,H;if(["fit_score","confidence","financial_health","growth_signals","referral_warmth"].some(C=>e[C]!=null)){const C={fit_score:.28,confidence:.2,financial_health:.18,growth_signals:.18,referral_warmth:.16};let F=0;for(const[K,G]of Object.entries(C))F+=wt(e[K])*G;return Math.round(F)}const t={role:25,sector:25,remote:15,health:15,referral:10,stage:10},d=(((H=(T=window.JobFlowConfig)==null?void 0:T.scoring)==null?void 0:H.preferences)||{}).sectors||[],u=(e.sector||"").toLowerCase(),m=(e.role||"").toLowerCase().includes("product")?1:.6,f=u&&d.length?d.some(C=>u.includes(C))?1:.6:.7,p=(e.location||"").toLowerCase().includes("remote")||(e.remote_policy||"").toLowerCase().includes("remote")?1:.6,L=m*t.role+f*t.sector+p*t.remote+.7*t.health+.5*t.referral+.6*t.stage;return Math.round(L)}function ht(e){return e>=70?"High":e>=40?"Medium":"Low"}async function bt(){var we,ge,he,be;await v();const e=document.getElementById("count"),n=document.getElementById("seed"),t=document.getElementById("clear"),l=document.getElementById("csvInput"),d=document.getElementById("discover"),u=document.getElementById("export"),m=document.getElementById("importSummary"),f=document.getElementById("roles"),p=document.getElementById("lastDisc"),b=document.getElementById("backupJson"),O=document.getElementById("nsm-ttq"),N=document.getElementById("nsm-csv"),L=document.getElementById("nsm-qual"),T=document.getElementById("nsm-moves"),H=document.getElementById("dashboardSection"),C=document.getElementById("dashHigh"),F=document.getElementById("dashMed"),K=document.getElementById("dashLow"),G=document.getElementById("planningSection"),ie=document.getElementById("planTargetDate"),le=document.getElementById("planTargetInterviews"),de=document.getElementById("planCbCold"),ue=document.getElementById("planCbWarm"),me=document.getElementById("planCbStrong"),Se=document.getElementById("planSave"),Ce=document.getElementById("weeklyCold"),je=document.getElementById("weeklyWarm"),De=document.getElementById("totalApps"),Le=document.getElementById("progCold"),Be=document.getElementById("progColdVal"),Me=document.getElementById("progWarm"),Pe=document.getElementById("progWarmVal"),$e=document.getElementById("coldInc"),Oe=document.getElementById("coldDec"),Ne=document.getElementById("warmInc"),Te=document.getElementById("warmDec");async function A(){const r=await it();e.textContent=`IndexedDB opportunities: ${r}`}if(n.addEventListener("click",async()=>{const r=new Date().toISOString().slice(0,10),a=[{company:"Grammarly",role:"Senior PM, AI Writing",job_url:"https://www.grammarly.com/jobs",stage:"To Apply",deadline:"2025-10-15",priority:"P0",source:"Seed",posted_at:r},{company:"Perplexity AI",role:"PM, Ecosystem",job_url:"https://www.perplexity.ai/careers",stage:"Applied",deadline:"2025-10-20",priority:"P0",source:"Seed",posted_at:r},{company:"Coinbase",role:"Sr Manager, Growth",job_url:"https://www.coinbase.com/careers",stage:"Interview",deadline:"2025-10-01",priority:"P1",source:"Seed",posted_at:r},{company:"Transcarent",role:"PM, Care Navigation",job_url:"https://www.transcarent.com/careers",stage:"Research",deadline:"2025-10-30",priority:"P2",source:"Seed",posted_at:r},{company:"Figma",role:"PM, AI Collaboration",job_url:"https://www.figma.com/careers",stage:"To Apply",deadline:"2025-10-25",priority:"P1",source:"Seed",posted_at:r}];for(const s of a)await Q(s);await A(),m.textContent=`Seeded ${a.length} records.`}),t.addEventListener("click",async()=>{await lt(),await A(),f.innerHTML="",m.textContent=""}),await A(),"serviceWorker"in navigator)try{const r=await navigator.serviceWorker.register("/sw.js"),a=document.getElementById("sw-status");a.textContent=r.active?"• Offline ready":"• Registering…"}catch(r){console.warn("SW registration failed",r)}const I=document.getElementById("qualModal"),z=document.getElementById("qualForm");let R=null;function Ae(r){var s;R=r.id;const a=document.getElementById("qualTitle");a&&(a.textContent=`Qualify — ${r.company||""} · ${r.role||""}`),(s=I==null?void 0:I.showModal)==null||s.call(I)}document.addEventListener("keydown",r=>{I!=null&&I.open&&((r.key==="a"||r.key==="A")&&(z.querySelector('input[value="accept"]').checked=!0),(r.key==="r"||r.key==="R")&&(z.querySelector('input[value="reject"]').checked=!0),r.key==="Escape"&&I.close())}),(we=document.getElementById("qualCancel"))==null||we.addEventListener("click",()=>I.close()),(ge=document.getElementById("qualSave"))==null||ge.addEventListener("click",async r=>{if(r.preventDefault(),R==null){I.close();return}const a=z.querySelector('input[name="decision"]:checked').value,s=document.getElementById("fitCat").value,i=+document.getElementById("confidence").value,o=document.getElementById("tags").value.split(",").map(g=>g.trim()).filter(Boolean),c=document.getElementById("notes").value.trim();await ut(R,{decision:a,fitCat:s,confidence:i,tags:o,notes:c}),await J(a==="accept"?"qualify_accept":"qualify_reject",{opportunityId:R,fitCat:s,confidence:i,tags:o});const y=(await P()).find(g=>g.id===R);y&&(y.stage=a==="accept"?"To Apply":"Offer/Reject",await Q(y)),I.close(),await pe(),await Y()});function ye(){return window.JobFlowConfig||{}}function Re(r){const a=(window.JobFlowConfig||{}).scoring||{},s=Object.assign({role:25,sector:25,remote:15,health:15,referral:10,stage:10},a.weights||{}),i=Object.assign({sectors:["ai","ml","fintech","health","product","design"],companyHealth:{},referrals:{},companyStage:{}},a.preferences||{});let o=0;const c=(r.role||"").toLowerCase(),w=(r.company||"").trim();/\b(product|pm|product manager|product management)\b/.test(c)&&(o+=s.role),i.sectors.some(h=>c.includes(h.toLowerCase()))&&(o+=s.sector),(/remote/.test(c)||/weworkremotely|remotive|remoteok|workingnomads|nodesk/.test((r.source||"").toLowerCase()))&&(o+=s.remote);const g=i.companyHealth[w];typeof g=="number"&&(o+=Math.round(s.health*Math.max(0,Math.min(1,g)))),i.referrals[w]&&(o+=s.referral);const _=(i.companyStage[w]||"").toLowerCase();return _==="startup"?o+=s.stage:_==="scaleup"?o+=Math.round(s.stage*.7):_==="public"&&(o+=Math.round(s.stage*.5)),Math.max(0,Math.min(100,o))}function We(r){try{const a=new Date(r);return Date.now()-a.getTime()<=60*24*3600*1e3}catch{return!0}}async function qe(r){const s=await(await fetch(r,{cache:"no-cache"})).text();return[...new DOMParser().parseFromString(s,"application/xml").querySelectorAll("item")].map(c=>{var w,y,g,_;return{company:(((w=c.querySelector("source,author"))==null?void 0:w.textContent)||"").trim(),role:(((y=c.querySelector("title"))==null?void 0:y.textContent)||"").trim(),job_url:(((g=c.querySelector("link"))==null?void 0:g.textContent)||"").trim(),source:new URL(r).hostname,posted_at:(((_=c.querySelector("pubDate"))==null?void 0:_.textContent)||"").trim()}})}async function He(){const r=["https://weworkremotely.com/categories/remote-product-jobs.rss","https://remotive.com/remote-jobs/rss?search=product%20manager","https://jobicy.com/?feed=job_feed&search_keywords=product%20manager&remote=on","https://remoteok.com/remote-product+manager-jobs.rss","https://www.workingnomads.com/jobs.rss?category=product","https://nodesk.co/remote-jobs/rss.xml","https://remote.co/remote-jobs/product/feed/"],a=[];for(const y of r)try{a.push(...await qe(y))}catch(g){console.warn("Discovery source failed",y,g)}const s=new Set,i=[];for(const y of a){const g=(y.company||"")+"|"+(y.role||"");s.has(g)||(s.add(g),!(y.posted_at&&!We(y.posted_at))&&i.push({...y,fit_score:Re(y),stage:"Research"}))}f.innerHTML=X(i);let o=0,c=0;for(const y of i)try{await Q(y),o++}catch{c++}m.textContent=`Discovered ${o} new; skipped ${c} duplicates.`,await J("discovery_run",{sources:r.length,discovered:i.length,inserted:o,skipped:c});const w=await re("discovery_run");p&&(p.textContent=w!=null&&w.length?new Date(w[w.length-1].ts).toLocaleString():"–"),await A()}d==null||d.addEventListener("click",()=>{if(!ye().enableDiscovery){m.textContent="Discovery disabled (toggle window.JobFlowConfig.enableDiscovery = true)";return}He()});const W=["company","role","sector","job_url","deadline","salary_range","location","remote_policy","contact_name","contact_linkedin","notes","fit_score"];let E=null,j=null;l==null||l.addEventListener("change",async r=>{var g,_;if(!ye().enableImport){m.textContent="Import disabled (toggle window.JobFlowConfig.enableImport = true)";return}const a=(g=r.target.files)==null?void 0:g[0];if(!a)return;const i=(await a.text()).split(/\r?\n/),o=((_=i.shift())==null?void 0:_.split(",").map(h=>h.trim()))||[];if(o.length!==W.length||o.some((h,D)=>h!==W[D])){m.textContent="Header mismatch. Use docs/csv_templates/discovery_import_template.csv";return}await J("csv_import_start",{rowsAttempted:i.length}),j=[],E=[],i.forEach((h,D)=>{var Ie;if(!h.trim())return;let M;try{M=((Ie=h.match(/\"([^\"]*(?:\"\"[^\"]*)*)\"(?=,|$)/g))==null?void 0:Ie.map(Z=>Z.slice(1,-1).replace(/\"\"/g,'"')))||h.split(",")}catch{M=h.split(",")}M.length<W.length&&j.push({line:D+2,error:"Too few columns"});const U=Object.fromEntries(W.map((Z,Ke)=>[Z,(M[Ke]||"").trim()])),V=[];U.company||V.push("company"),U.role||V.push("role"),U.job_url||V.push("job_url"),E.push({...U,__errors:V})}),f.innerHTML=Ue(E,j),m.textContent=j.length?`Preview: ${E.length} rows, ${j.length} line errors. Press Enter to import or Esc to cancel.`:`Preview: ${E.length} rows. Press Enter to import or Esc to cancel.`;function c(h){h.key==="Enter"&&(h.preventDefault(),w()),h.key==="Escape"&&(h.preventDefault(),y())}document.addEventListener("keydown",c,{once:!1});async function w(){document.removeEventListener("keydown",c,!1);let h=0,D=0;for(const M of E)try{await Q(M),h++}catch{D++}f.innerHTML=X(E),await J("csv_import_complete",{rowsAttempted:E.length,rowsImported:h,skipped:D}),m.textContent=`Imported ${h}; skipped ${D} duplicates.`,E=null,j=null,await A(),await Y()}function y(){document.removeEventListener("keydown",c,!1),E=null,j=null,f.innerHTML="",m.textContent="Import canceled."}}),u==null||u.addEventListener("click",async()=>{const r=await P(),a=W,s=[a.join(",")];for(const c of r){const w=a.map(y=>`"${String(c[y]||"").replace(/"/g,'""')}"`);s.push(w.join(","))}const i=new Blob([s.join(`
`)],{type:"text/csv"}),o=document.createElement("a");o.href=URL.createObjectURL(i),o.download="jobflow_export.csv",o.click(),URL.revokeObjectURL(o.href)});function Fe(r){const a="<tr><th>Company</th><th>Role</th><th>URL</th><th>Fit</th></tr>",s=r.map(i=>`<tr><td>${i.company||""}</td><td>${i.role||""}</td><td>${i.job_url?`<a href="${i.job_url}" target="_blank">open</a>`:""}</td><td>${i.fit_score??""}</td></tr>`).join("");return`<tbody>${a}${s}</tbody>`}const fe=await P();fe.length&&(f.innerHTML=Fe(fe));function X(r){const a="<tr><th>Company</th><th>Role</th><th>URL</th><th>Fit</th><th></th></tr>",s=r.map(i=>`<tr><td>${i.company||""}</td><td>${i.role||""}</td><td>${i.job_url?`<a href="${i.job_url}" target="_blank">open</a>`:""}</td><td>${i.fit_score??""}</td><td>${i.id?`<button data-id="${i.id}" class="qbtn">Qualify</button>`:""}</td></tr>`).join("");return`<tbody>${a}${s}</tbody>`}function Ue(r,a){const s="<tr><th>Line</th><th>Company</th><th>Role</th><th>URL</th><th>Errors</th></tr>",i=(r||[]).map((c,w)=>`<tr><td>${w+2}</td><td>${c.company||""}</td><td>${c.role||""}</td><td>${c.job_url||""}</td><td>${(c.__errors||[]).join(" ")}</td></tr>`).join(""),o=(a||[]).map(c=>`<tr><td>${c.line}</td><td colspan="4" style="color:#f59e0b">${c.error}</td></tr>`).join("");return`<tbody>${s}${i}${o}</tbody>`}f.addEventListener("click",async r=>{const a=r.target.closest("button.qbtn");if(!a)return;const s=parseInt(a.getAttribute("data-id"),10),o=(await P()).find(c=>c.id===s);o&&Ae(o)});async function pe(){const r=await P();f.innerHTML=X(r)}async function Y(){const r=await re("csv_import_complete");if(r!=null&&r.length){const s=r[r.length-1],{rowsAttempted:i=0,rowsImported:o=0}=s.data||{};N&&(N.textContent=`CSV success rate (last): ${i?Math.round(o/i*100):0}%`)}else N&&(N.textContent="CSV success rate (last): –");const a=await mt();a!=null&&a.length?(O&&(O.textContent=`TtQ (count): ${a.length} reviewed`),L&&(L.textContent=`Qualification modal usage (session): ${a.length}`)):(O&&(O.textContent="TtQ (7/30d): –"),L&&(L.textContent="Qualification modal usage (session): –")),T&&(T.textContent="Kanban moves coverage: n/a (Phase 2)")}b==null||b.addEventListener("click",async()=>{const r=await yt(),a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download="jobflow_backup.json",s.click(),URL.revokeObjectURL(s.href)}),await pe();const q=await re("discovery_run");p&&(p.textContent=q!=null&&q.length?new Date(q[q.length-1].ts).toLocaleString():"–"),await Y(),(he=window.JobFlowConfig)!=null&&he.enableDashboard&&(H.style.display="block",await Ve()),(be=window.JobFlowConfig)!=null&&be.enablePlanning&&(G.style.display="block",await Qe());async function Ve(){const a=(await P()).map(o=>({...o,__score:gt(o),__band:null})).map(o=>({...o,__band:ht(o.__score)})),s={High:[],Medium:[],Low:[]};for(const o of a)s[o.__band].push(o);const i=o=>`<div class="card" style="margin:8px 0;padding:12px"><div style="font-weight:700">${o.company||""} — ${o.role||""}</div><div style="opacity:.85">Score: ${o.__score} · Stage: ${o.stage||""}${o.deadline?` · Due: ${o.deadline}`:""}</div></div>`;C.innerHTML=s.High.sort((o,c)=>c.__score-o.__score).map(i).join("")||'<p style="opacity:.7">No high priority items</p>',F.innerHTML=s.Medium.sort((o,c)=>c.__score-o.__score).map(i).join("")||'<p style="opacity:.7">No medium priority items</p>',K.innerHTML=s.Low.sort((o,c)=>c.__score-o.__score).map(i).join("")||'<p style="opacity:.7">No low priority items</p>'}async function Qe(){var a,s,i;await pt();const r=await k();r.targetDate&&(ie.value=r.targetDate),le.value=r.targetInterviews??5,de.value=((a=r.callbacks)==null?void 0:a.cold)??8,ue.value=((s=r.callbacks)==null?void 0:s.warm)??40,me.value=((i=r.callbacks)==null?void 0:i.strong)??60,await B(),Se.addEventListener("click",async()=>{const o={targetDate:ie.value||"",targetInterviews:Number(le.value)||5,callbacks:{cold:Number(de.value)||8,warm:Number(ue.value)||40,strong:Number(me.value)||60}};await $(o),await B()}),$e.addEventListener("click",async()=>{var c;const o=await k();o.weeklyProgress={...o.weeklyProgress||{cold:0,warm:0},cold:(((c=o.weeklyProgress)==null?void 0:c.cold)||0)+1},await $(o),await B()}),Oe.addEventListener("click",async()=>{var c;const o=await k();o.weeklyProgress={...o.weeklyProgress||{cold:0,warm:0},cold:Math.max(0,(((c=o.weeklyProgress)==null?void 0:c.cold)||0)-1)},await $(o),await B()}),Ne.addEventListener("click",async()=>{var c;const o=await k();o.weeklyProgress={...o.weeklyProgress||{cold:0,warm:0},warm:(((c=o.weeklyProgress)==null?void 0:c.warm)||0)+1},await $(o),await B()}),Te.addEventListener("click",async()=>{var c;const o=await k();o.weeklyProgress={...o.weeklyProgress||{cold:0,warm:0},warm:Math.max(0,(((c=o.weeklyProgress)==null?void 0:c.warm)||0)-1)},await $(o),await B()})}function Je(r,a){if(!r||!a)return 12;const s=new Date,i=new Date(a),o=Math.max(0,i-s);return Math.max(1,Math.ceil(o/(1e3*60*60*24*7)))}async function B(){var _,h;const r=await k(),a=Je(new Date().toISOString(),r.targetDate),s=(((_=r.callbacks)==null?void 0:_.warm)||40)/100,i=(((h=r.callbacks)==null?void 0:h.cold)||8)/100,o=Math.ceil((r.targetInterviews||5)*.5/Math.max(.01,s)),c=Math.ceil((r.targetInterviews||5)*.5/Math.max(.01,i)),w=Math.max(1,Math.ceil(o/a)),y=Math.max(1,Math.ceil(c/a));je.textContent=`${w}`,Ce.textContent=`${y}`,De.textContent=`${o+c}`;const g=r.weeklyProgress||{cold:0,warm:0};Be.textContent=String(g.cold),Pe.textContent=String(g.warm),Le.style.width=`${Math.min(100,Math.round(g.cold/y*100))}%`,Me.style.width=`${Math.min(100,Math.round(g.warm/w*100))}%`}}bt();
