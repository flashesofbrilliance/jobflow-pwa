(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const Ce="modulepreload",De=function(t,e){return new URL(t,e).href},z={},Ae=function(e,n,o){let s=Promise.resolve();if(n&&n.length>0){const i=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=De(l,o),l in z)return;z[l]=!0;const u=l.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!o)for(let _=i.length-1;_>=0;_--){const g=i[_];if(g.href===l&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":Ce,u||(y.as="script"),y.crossOrigin="",y.href=l,c&&y.setAttribute("nonce",c),document.head.appendChild(y),u)return new Promise((_,g)=>{y.addEventListener("load",_),y.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return s.then(i=>{for(const r of i||[])r.status==="rejected"&&a(r.reason);return e().catch(a)})},Te="1.2.0",Oe="jobflow",Pe=7,Me=[{id:"research",name:"Research"},{id:"to-apply",name:"To Apply"},{id:"applied",name:"Applied"},{id:"interview",name:"Interview"},{id:"offer",name:"Offer/Reject"}];let I=Me.map(t=>({...t}));const Re={P0:"#FF5459",P1:"#22C55E",P2:"#F59E0B",P3:"#6B7280"},qe=["RoleMismatch","Location","Compensation","Stage","Timing","Culture","Health"],Fe=["RoleMismatch","Location","Compensation","Stage","Timing","Culture","Health"],Ue={company:["company","employer","org","organization","company_name"],role:["role","title","position","job_title","role title"],job_url:["job_url","url","link","job_link","posting","posting_url","direct job link"],status:["status","stage","pipeline","column","application stage"],priority_score:["priority_score","priority","prio","score_priority"],fit_score:["fit_score","fit","match","score_fit"],fit_flag:["fit_flag","fit flag","fit rating"],deadline:["deadline","due","due_date","apply_by","application_deadline"],posted_at:["posted_at","posted","posted at","date posted","post_date"],applicant_volume:["applicant_volume","applicants","apps","apps_count","applicant count","volume"],interest_score:["interest","interest_score","interest score"],location:["location","city","region"],segment:["segment","industry","segment / industry","sector"],notes:["notes","note","comments","comment","summary","desc","description"]},w=(t,e=document)=>e.querySelector(t),P=(t,e=document)=>Array.from(e.querySelectorAll(t));function p(t,e={},...n){const o=document.createElement(t);Object.entries(e).forEach(([s,a])=>{s==="class"?o.className=a:s==="dataset"?Object.assign(o.dataset,a):s.startsWith("on")&&typeof a=="function"?o.addEventListener(s.substring(2),a):o.setAttribute(s,a)});for(const s of n)o.append(s&&s.nodeType?s:document.createTextNode(s??""));return o}function He(t){if(!t)return{label:"",cls:""};const e=new Date,n=new Date(t),o=Math.ceil((n-e)/(1e3*60*60*24));return o<0?{label:`ðŸ”´ ${Math.abs(o)}d overdue`,cls:"bad"}:o<=3?{label:`ðŸŸ¡ ${o}d`,cls:"mid"}:{label:`ðŸŸ¢ ${o}d`,cls:"ok"}}function Ve(t=0){let e="P3";return t>=90?e="P0":t>=75?e="P1":t>=60&&(e="P2"),{label:e,color:Re[e]}}function Ie(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return(e>>>0).toString(16)}function h(){return new Promise((t,e)=>{const n=indexedDB.open(Oe,Pe);n.onupgradeneeded=()=>{var s,a,i,r,c,l,u;const o=n.result;if(!o.objectStoreNames.contains("opportunities")){const m=o.createObjectStore("opportunities",{keyPath:"id"});m.createIndex("status","status"),m.createIndex("hash","hash"),m.createIndex("deadline","deadline"),m.createIndex("posted_at","posted_at"),m.createIndex("location","location")}if(o.objectStoreNames.contains("profile")||o.createObjectStore("profile",{keyPath:"key"}),!o.objectStoreNames.contains("reflections")){const m=o.createObjectStore("reflections",{keyPath:"id"});m.createIndex("by_ts","ts"),m.createIndex("by_type","type")}o.objectStoreNames.contains("analytics_snapshots")||o.createObjectStore("analytics_snapshots",{keyPath:"id"}).createIndex("by_week","week"),o.objectStoreNames.contains("goals")||o.createObjectStore("goals",{keyPath:"key"});try{const m=((s=o.transaction("opportunities","versionchange"))==null?void 0:s.objectStore("opportunities"))||o.objectStoreNames.contains("opportunities")&&o.createObjectStore("opportunities",{keyPath:"id"});m&&!((i=(a=m.indexNames)==null?void 0:a.contains)!=null&&i.call(a,"deadline"))&&m.createIndex("deadline","deadline"),m&&!((c=(r=m.indexNames)==null?void 0:r.contains)!=null&&c.call(r,"posted_at"))&&m.createIndex("posted_at","posted_at"),m&&!((u=(l=m.indexNames)==null?void 0:l.contains)!=null&&u.call(l,"location"))&&m.createIndex("location","location")}catch{}o.objectStoreNames.contains("qualification_reviews")||o.createObjectStore("qualification_reviews",{keyPath:"id"}),o.objectStoreNames.contains("kanban_state")||o.createObjectStore("kanban_state",{keyPath:"column_id"}),o.objectStoreNames.contains("research_intel")||o.createObjectStore("research_intel",{keyPath:"id"}),o.objectStoreNames.contains("user_preferences")||o.createObjectStore("user_preferences",{keyPath:"key"}),o.objectStoreNames.contains("meta")||o.createObjectStore("meta",{keyPath:"key"})},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)})}function W(t,e,n="readonly"){return t.transaction(e,n).objectStore(e)}async function E(t,e){return new Promise((n,o)=>{const s=W(t,e).getAll();s.onsuccess=()=>n(s.result||[]),s.onerror=()=>o(s.error)})}async function b(t,e,n){return new Promise((o,s)=>{const a=W(t,e,"readwrite").put(n);a.onsuccess=()=>o(n),a.onerror=()=>s(a.error)})}async function M(t,e,n){return new Promise((o,s)=>{const a=t.transaction(e,"readwrite"),i=a.objectStore(e);n.forEach(r=>i.put(r)),a.oncomplete=()=>o(n),a.onerror=()=>s(a.error)})}async function v(t,e,n){return new Promise((o,s)=>{const a=W(t,e).get(n);a.onsuccess=()=>o(a.result),a.onerror=()=>s(a.error)})}const Ge=[{company:"Grammarly",role:"Sr PM, AI Writing",status:"to-apply",fit_score:92,deadline:"2025-10-15"},{company:"Perplexity AI",role:"PM, Ecosystem Integrations",status:"applied",fit_score:90,deadline:"2025-10-20"},{company:"Base (Coinbase)",role:"Sr Manager, Growth",status:"interview",fit_score:78,deadline:"2025-10-01"},{company:"Transcarent",role:"PM, Care Navigation",status:"research",fit_score:80,deadline:"2025-10-30"},{company:"Figma",role:"PM, AI Collaboration",status:"to-apply",fit_score:82,deadline:"2025-10-25"}];async function We(t){if((await E(t,"opportunities")).length)return;const n=Ge.map(o=>{const s=crypto.randomUUID(),a="",i=Ie([o.company,o.role,a].join("|").toLowerCase());return{id:s,company:o.company,role:o.role,status:o.status,priority_score:o.fit_score,fit_score:o.fit_score,deadline:o.deadline||"",notes:"",job_url:a,hash:i,created_at:Date.now(),posted_at:"",location:"",segment:"",applicant_volume:0,interest_score:0}});await M(t,"opportunities",n);for(const o of I)await b(t,"kanban_state",{column_id:o.id,opportunity_ids:n.filter(s=>s.status===o.id).map(s=>s.id)});await b(t,"meta",{key:"schema_version",value:1}),await b(t,"meta",{key:"appVersion",value:Te})}function Qe(t){const e=!!window.indexedDB;return{discoveryAvailable:navigator.onLine&&!1,qualificationAvailable:e&&t,archiveAvailable:e&&t,analyticsAvailable:e&&t}}function Je(t,e){const n=w("#kanban");if(!n)return;n.innerHTML="";let o=t;try{const a=window.__gatedCache!==void 0?window.__gatedCache:null}catch{}const s=(async()=>{try{const a=await h(),i=await v(a,"user_preferences","gated");return(i==null?void 0:i.value)??!0}catch{return!0}})();window.__renderKanbanPromise=(async()=>{var i,r,c;if(await s){const l=await h(),u=await v(l,"profile","profile"),m=Number(((i=u==null?void 0:u.gates)==null?void 0:i.min_fit)||70),d=Number(((r=u==null?void 0:u.gates)==null?void 0:r.min_energy)||7);o=t.filter(y=>{const _=Array.isArray(y.barriers)?y.barriers:[],g=Number(y.total_fit||y.fit_score||0),L=Number(y.energy_score||0);return _.length===0&&g>=m&&L>=d})}for(const l of I){const u=((c=e[l.id])==null?void 0:c.opportunity_ids)||[],m=u.length?u.map(g=>o.find(L=>L.id===g)).filter(Boolean):o.filter(g=>g.status===l.id),d=p("h3",{},p("span",{},l.name),p("span",{class:"muted"},`${m.length}`)),y=p("div",{class:"lane",ondragover:g=>g.preventDefault(),ondrop:g=>Ye(g,l.id)}),_=p("div",{class:"column",dataset:{col:l.id}});_.append(d,y);for(const g of m)y.append(Ke(g));n.append(_)}})()}function Ke(t){const e=Ve(t.priority_score||0),n=He(t.deadline),o=p("div",{class:"cardk",draggable:!0,dataset:{id:t.id},ondragstart:ze,onclick:()=>Xe(t.id)}),s=p("div",{class:"title"},`${t.company} â€” ${t.role}`),a=p("div",{class:"meta"},p("span",{},"Fit ",t.fit_score??"-"),p("span",{},"â€¢"," "),p("span",{},"Prio ",p("span",{class:"prio",style:`background:${e.color}`},""),` ${e.label}`),p("span",{},"â€¢"," "),p("span",{class:`deadline ${n.cls}`},n.label||""),t.location?p("span",{},"â€¢ ",t.location):document.createTextNode(""),t.energy_score?p("span",{},"â€¢ Energy ",String(t.energy_score),"/10"):document.createTextNode(""),t.total_fit?p("span",{},"â€¢ Fit ",String(t.total_fit),"%"):document.createTextNode(""),t.honesty_label?p("span",{},"â€¢ ",t.honesty_label):document.createTextNode(""),p("button",{class:"btn",style:"margin-left:auto;",onclick:i=>{i.stopPropagation(),Le(t.id)}},"Triage"));return o.append(s,a),o}let V=null;function ze(t){V=t.currentTarget.dataset.id,t.dataTransfer.setData("text/plain",V)}async function Ye(t,e){t.preventDefault();const n=t.dataTransfer.getData("text/plain")||V;if(!n)return;const o=await h(),s=await v(o,"opportunities",n);if(!s)return;const a=s.status;s.status=e;const i=Array.isArray(s.stage_history)?s.stage_history:[];i.push({from:a,to:e,ts:Date.now()}),s.stage_history=i,await b(o,"opportunities",s);const r=await A(o);for(const c of I)r[c.id]||(r[c.id]={column_id:c.id,opportunity_ids:[]}),r[c.id].opportunity_ids=r[c.id].opportunity_ids.filter(l=>l!==n);r[e]||(r[e]={column_id:e,opportunity_ids:[]}),r[e].opportunity_ids=[n,...r[e].opportunity_ids],await R(o,r),await S()}async function A(t){const e=await E(t,"kanban_state"),n={};for(const o of e)n[o.column_id]=o;return n}async function R(t,e){const n=Object.values(e);await M(t,"kanban_state",n)}async function S(){const t=await h(),e=await E(t,"opportunities"),n=await A(t);Je(e,n),K(e),et(await E(t,"qualification_reviews"),e),nt(e,await E(t,"qualification_reviews")),Ze(e.length>0)}function Ze(t){const e=Qe(t);(async()=>{try{const n=await h(),o=await E(n,"opportunities"),s=[];o.forEach(d=>(d.sessions||[]).forEach(y=>s.push(y)));const r=(d=>{const y=new Date(d),_=(y.getDay()+6)%7;return y.setHours(0,0,0,0),y.setDate(y.getDate()-_),y})(new Date).getTime(),l=s.filter(d=>(d.ended_at||d.started_at)&&new Date(d.ended_at||d.started_at).getTime()>=r).filter(d=>(d.outcome||"")==="done").length,u=3;let m=0;for(let d=0;d<30;d++){const y=new Date;y.setDate(y.getDate()-d),y.setHours(0,0,0,0);const _=y.getTime(),g=_+24*3600*1e3;if(s.some(B=>{const j=new Date(B.ended_at||B.started_at||0).getTime();return j>=_&&j<g&&(B.outcome||"")==="done"}))m++;else break}w("#cap-status").textContent=["Offline-first",e.qualificationAvailable?"Qual: on":"Qual: off",`Streak ${m}d`,`Weekly ${l}/${u}`].join(" â€¢ ")}catch{w("#cap-status").textContent=["Offline-first",e.qualificationAvailable?"Qual: on":"Qual: off"].join(" â€¢ ")}})()}let C=null;function Xe(t){C=t,w("#qual-modal").classList.add("show"),w("#qm-fit").value="Good",w("#qm-confidence").value=70,w("#qm-brief").value=ke();const e=w("#qm-objs");e.innerHTML="",qe.forEach(o=>e.append(Y(o,"obj")));const n=w("#qm-excls");n.innerHTML="",Fe.forEach(o=>n.append(Y(o,"ex"))),w("#qm-deadline").value=""}function Y(t,e){const n=p("span",{class:"chip",onclick:()=>n.classList.toggle("on")},t);return n.dataset.group=e,n}function Q(){w("#qual-modal").classList.remove("show"),C=null}function ke(){return"Initial assessment: role alignment good; verify scope, team, and compensation. Risks: timeline and seniority match."}async function D(t){var y,_;if(!C)return;const e=await h(),n=await v(e,"opportunities",C),o=w("#qm-fit").value,s=Math.max(0,Math.min(100,parseInt(w("#qm-confidence").value||"0",10))),a=w("#qm-brief").value||ke(),i=w("#qm-deadline").value||"",r=P("#qm-objs .chip.on").map(g=>g.textContent),c=P("#qm-excls .chip.on").map(g=>g.textContent),l={id:crypto.randomUUID(),opportunity_id:C,decision:t,fit_category:o,objections:r,exclusions:c,confidence:s,briefing_text:a,reviewed_at:Date.now()};if(await b(e,"qualification_reviews",l),i&&(n.deadline=i),t==="Accept"){try{const g=await v(e,"profile","profile"),L=Number(((y=g==null?void 0:g.gates)==null?void 0:y.min_fit)||70),B=Number(((_=g==null?void 0:g.gates)==null?void 0:_.min_energy)||7),j=Number(n.total_fit||n.fit_score||0),q=Number(n.energy_score||0);if((Array.isArray(n.barriers)?n.barriers:[]).length){alert("Brutal Honesty: structural barriers detected. Resolve first.");return}if(j<L||q<B){alert("Gate not met (fit/energy). Adjust in Profile or reconsider.");return}}catch{}n.status="to-apply"}t==="Reject"&&(n.status="offer"),await b(e,"opportunities",n);const u=await A(e);for(const g of I)u[g.id]||(u[g.id]={column_id:g.id,opportunity_ids:[]}),u[g.id].opportunity_ids=u[g.id].opportunity_ids.filter(L=>L!==n.id);const m=n.status,d=Array.isArray(n.stage_history)?n.stage_history:[];d.push({from:"qualification",to:m,ts:Date.now()}),n.stage_history=d,u[m].opportunity_ids=[n.id,...u[m].opportunity_ids],await R(e,u),Q(),await S()}function et(t,e){const n=w("#archive-list");if(!n)return;const o=new Map(e.map(a=>[a.id,a])),s=t.filter(a=>a.decision==="Reject").sort((a,i)=>i.reviewed_at-a.reviewed_at);n.innerHTML="";for(const a of s){const i=o.get(a.opportunity_id),r=p("div",{class:"cardk"},p("div",{class:"title"},`${(i==null?void 0:i.company)||"Unknown"} â€” ${(i==null?void 0:i.role)||""}`),p("div",{class:"meta"},`Fit ${a.fit_category} â€¢ Conf ${a.confidence} â€¢ ${new Date(a.reviewed_at).toLocaleDateString()}`),p("div",{class:"muted"},`Objections: ${a.objections.join(", ")||"â€”"} | Exclusions: ${a.exclusions.join(", ")||"â€”"}`),p("div",{style:"margin-top:6px;"},a.briefing_text||"â€”"),p("div",{class:"actions",style:"margin-top:8px; justify-content:flex-start;"},p("button",{class:"btn",onclick:()=>tt(i==null?void 0:i.id)},"Restore to Pipeline")));n.append(r)}}async function tt(t){if(!t)return;const e=await h(),n=await v(e,"opportunities",t);if(!n)return;n.status="research",await b(e,"opportunities",n);const o=await A(e);for(const s of I)o[s.id]||(o[s.id]={column_id:s.id,opportunity_ids:[]}),o[s.id].opportunity_ids=o[s.id].opportunity_ids.filter(a=>a!==t);o.research.opportunity_ids=[t,...o.research.opportunity_ids],await R(e,o),await S()}function nt(t,e){const n=w("#funnel"),o=w("#objections"),s=w("#sources");if(!n)return;const a={discovery:t.length,qualified:e.filter(c=>c.decision==="Accept").length,applied:t.filter(c=>c.status==="applied").length,interview:t.filter(c=>c.status==="interview").length,offer:t.filter(c=>c.status==="offer").length};n.innerHTML="";for(const[c,l]of Object.entries(a)){const u=p("div",{},p("div",{},`${c} â€” ${l}`),p("div",{class:"bar"},p("span",{style:`width:${a.discovery?l/a.discovery*100:0}%`})));n.append(u)}const i={};e.filter(c=>c.decision==="Reject").forEach(c=>c.objections.forEach(l=>i[l]=(i[l]||0)+1)),o.innerHTML="",Object.entries(i).sort((c,l)=>l[1]-c[1]).forEach(([c,l])=>{o.append(p("div",{},`${c}: ${l}`))}),s.innerHTML="";const r={"to-apply":0,applied:0,interview:0,offer:0};t.forEach(c=>{r[c.status]!=null&&r[c.status]++}),Object.entries(r).forEach(([c,l])=>s.append(p("div",{},`${c}: ${l}`)))}function ot(t){const e=[];let n=0,o="",s=!1,a=[];for(;n<t.length;){const i=t[n];s?i==='"'?t[n+1]==='"'?(o+='"',n++):s=!1:o+=i:i==='"'?s=!0:i===","?(a.push(o),o=""):i===`
`||i==="\r"?((o!==""||a.length)&&(a.push(o),e.push(a),a=[],o=""),i==="\r"&&t[n+1]==`
`&&n++):o+=i,n++}return(o!==""||a.length)&&(a.push(o),e.push(a)),e}function J(t){["discovery","kanban","archive","analytics","about"].forEach(e=>{w("#view-"+e).classList.toggle("hidden",e!==t),P("nav button").forEach(n=>n.classList.toggle("active",n.dataset.view===t))})}P("nav button").forEach(t=>t.addEventListener("click",()=>J(t.dataset.view)));var te;(te=w("#qm-cancel"))==null||te.addEventListener("click",Q);var ne;(ne=w("#qm-save"))==null||ne.addEventListener("click",()=>D("Accept"));var oe;(oe=w("#qm-accept"))==null||oe.addEventListener("click",()=>D("Accept"));var se;(se=w("#qm-reject"))==null||se.addEventListener("click",()=>D("Reject"));document.addEventListener("keydown",t=>{w("#qual-modal").classList.contains("show")&&(t.key==="Escape"&&Q(),t.key.toLowerCase()==="a"&&D("Accept"),t.key.toLowerCase()==="r"&&D("Reject"))});const k=w("#dropzone"),O=w("#csvFile");k==null||k.addEventListener("dragover",t=>{t.preventDefault(),k.classList.add("drag")});k==null||k.addEventListener("dragleave",()=>k.classList.remove("drag"));k==null||k.addEventListener("drop",async t=>{var n;t.preventDefault(),k.classList.remove("drag");const e=(n=t.dataTransfer.files)==null?void 0:n[0];e&&await Se(e)});O==null||O.addEventListener("change",async()=>{var e;const t=(e=O.files)==null?void 0:e[0];t&&await Se(t)});async function Se(t){ct(t)}var ae;(ae=w("#apply-archive-filters"))==null||ae.addEventListener("click",async()=>{await S()});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(()=>{const t=document.getElementById("sw-status");t&&(t.textContent="Offline ready")}).catch(console.error)});(async function(){const e=await h();await We(e),await vt();try{const n=await E(e,"opportunities");let o=0;for(const s of n)if(s.snooze_until){const a=new Date(Date.now()+1728e5);s.next_action=s.next_action||{type:"review",durationMin:15,planned_at:a.toISOString(),planned_source:"migration"},delete s.snooze_until,await b(e,"opportunities",s),o++}}catch{}await S(),J("kanban");try{const n=await v(e,"user_preferences","density"),o=(n==null?void 0:n.value)||"comfortable";document.body.classList.toggle("density-compact",o==="compact");const s=document.getElementById("density-toggle");s&&(s.textContent=o==="compact"?"Comfortable":"Compact"),s==null||s.addEventListener("click",async()=>{const a=document.body.classList.toggle("density-compact");await b(e,"user_preferences",{key:"density",value:a?"compact":"comfortable"});const r=document.getElementById("density-toggle");r&&(r.textContent=a?"Comfortable":"Compact")})}catch{}})();var ie;(ie=document.getElementById("stages-edit"))==null||ie.addEventListener("click",async()=>{const t=I.map(o=>o.name).join(", "),e=prompt("Edit stages (comma-separated, leftâ†’right):",t);if(e==null)return;const n=e.split(",").map(o=>o.trim()).filter(Boolean);n.length&&(await Et(n),await S(),alert("Stages updated."))});var re;(re=document.getElementById("profile-open"))==null||re.addEventListener("click",async()=>{var o,s,a,i,r,c;const t=await h(),e=await v(t,"profile","profile"),n=document.getElementById("profile-modal");document.getElementById("p-comm").value=String(((o=e==null?void 0:e.work_style)==null?void 0:o.comm)??6),document.getElementById("p-pace").value=String(((s=e==null?void 0:e.work_style)==null?void 0:s.pace)??7),document.getElementById("p-feedback").value=String(((a=e==null?void 0:e.work_style)==null?void 0:a.feedback)??6),document.getElementById("p-collab").value=String(((i=e==null?void 0:e.work_style)==null?void 0:i.collab)??6),document.getElementById("p-minfit").value=String(((r=e==null?void 0:e.gates)==null?void 0:r.min_fit)??70),document.getElementById("p-minenergy").value=String(((c=e==null?void 0:e.gates)==null?void 0:c.min_energy)??7),n.classList.add("show")});var ce;(ce=document.getElementById("profile-cancel"))==null||ce.addEventListener("click",()=>{var t;(t=document.getElementById("profile-modal"))==null||t.classList.remove("show")});var le;(le=document.getElementById("profile-save"))==null||le.addEventListener("click",async()=>{var n;const t=await h(),e=await v(t,"profile","profile")||{key:"profile"};e.work_style={comm:Number(document.getElementById("p-comm").value)||6,pace:Number(document.getElementById("p-pace").value)||7,feedback:Number(document.getElementById("p-feedback").value)||6,collab:Number(document.getElementById("p-collab").value)||6},e.gates={min_fit:Number(document.getElementById("p-minfit").value)||70,min_energy:Number(document.getElementById("p-minenergy").value)||7},e.key="profile",await b(t,"profile",e),(n=document.getElementById("profile-modal"))==null||n.classList.remove("show")});let x=null;async function Le(t){var c;x=t;const e=await h(),n=await v(e,"opportunities",t),o=document.getElementById("triage-body");if(!n||!o)return;const s=(l,u)=>`<div class="row" style="justify-content:space-between;"><span class="muted">${l}</span><span>${u}</span></div>`,a=[];if(a.push(s("Company",n.company||"")),a.push(s("Role",n.role||"")),a.push(s("Honesty",n.honesty_label||"-")),a.push(s("Energy",n.energy_score?`${n.energy_score}/10`:"-")),a.push(s("Fit",n.total_fit?`${n.total_fit}%`:n.fit_score??"-")),n.base_score!=null&&a.push(s("Base",`${n.base_score}%`)),n.culture_score!=null&&a.push(s("Culture",`${n.culture_score}%`)),n.timing_score!=null&&a.push(s("Timing",`${n.timing_score}%`)),n.alumni_score!=null&&a.push(s("Alumni",`${n.alumni_score}%`)),n.work_style_score!=null&&a.push(s("Work Style",`${n.work_style_score}%`)),n.culture_dims){const l=n.culture_dims,u=(m,d)=>`<div><div class="muted">${m}</div><div class="bar"><span style="width:${Math.min(100,Math.max(0,(d||0)/10*100))}%"></span></div></div>`;a.push(`<div class="rowgrid">${u("Comm",l.comm)}${u("Pace",l.pace)}${u("Feedback",l.feedback)}${u("Collab",l.collab)}</div>`)}const i=(n.barriers||[]).join(", ");i&&a.push(s("Barriers",i));const r=(n.honesty_evidence||[]).join(" â€¢ ");r&&a.push(s("Evidence",r)),o.innerHTML=a.join(""),(c=document.getElementById("triage-modal"))==null||c.classList.add("show")}function T(){var t;(t=document.getElementById("triage-modal"))==null||t.classList.remove("show"),x=null}var de;(de=document.getElementById("triage-close"))==null||de.addEventListener("click",T);var ue;(ue=document.getElementById("triage-reject"))==null||ue.addEventListener("click",async()=>{if(!x)return;const t=await h(),e=await v(t,"opportunities",x);if(!e)return;const n=e.status||"research";e.status="offer";const o=Array.isArray(e.stage_history)?e.stage_history:[];o.push({from:n,to:"offer",ts:Date.now()}),e.stage_history=o,await b(t,"opportunities",e),T(),await S()});var me;(me=document.getElementById("triage-accept"))==null||me.addEventListener("click",async()=>{if(!x)return;const t=await h(),e=await v(t,"opportunities",x);if(!e)return;const n=prompt("Force Accept justification (1 line)");if(!n)return;const o=e.status||"research";e.status="to-apply";const s=Array.isArray(e.stage_history)?e.stage_history:[];s.push({from:o,to:"to-apply",ts:Date.now(),note:`force:${n}`}),e.stage_history=s,await b(t,"opportunities",e),T(),await S()});function $(t){return String(t).padStart(2,"0")}function U(t){const e=t.getUTCFullYear(),n=$(t.getUTCMonth()+1),o=$(t.getUTCDate()),s=$(t.getUTCHours()),a=$(t.getUTCMinutes()),i=$(t.getUTCSeconds());return`${e}${n}${o}T${s}${a}${i}Z`}function st(t,e,n,o){const s=new Date(n.getTime()+o*6e4),a=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//JobFlow//EN","BEGIN:VEVENT","DTSTAMP:"+U(new Date),"DTSTART:"+U(n),"DTEND:"+U(s),`SUMMARY:JobFlow ${e} â€” ${t.company} â€” ${t.role}`,`DESCRIPTION:Planned via JobFlow triage. Link: ${t.job_url||""}`,"END:VEVENT","END:VCALENDAR"];return new Blob([a.join(`\r
`)],{type:"text/calendar"})}function at(t,e,n,o){const s=new Date(n.getTime()+o*6e4),a=l=>encodeURIComponent(l.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z")),i=a(n)+"/"+a(s),r=encodeURIComponent(`JobFlow ${e} â€” ${t.company} â€” ${t.role}`),c=encodeURIComponent(`Planned via JobFlow triage. ${t.job_url||""}`);return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${i}&details=${c}`}var pe;(pe=document.getElementById("triage-duration"))==null||pe.addEventListener("change",()=>{const t=document.getElementById("triage-duration"),e=document.getElementById("triage-duration-custom");t.value==="custom"?e.style.display="block":e.style.display="none"});var fe;(fe=document.getElementById("triage-plan"))==null||fe.addEventListener("click",async()=>{if(!x)return;const t=await h(),e=await v(t,"opportunities",x);if(!e)return;const n=document.getElementById("triage-type").value||"apply",o=document.getElementById("triage-duration").value,s=o==="custom"?Number(document.getElementById("triage-duration-custom").value)||25:Number(o),a=document.getElementById("triage-when").value,i=a?new Date(a):new Date(Date.now()+60*6e4);e.next_action={type:n,durationMin:s,planned_at:i.toISOString(),planned_source:"triage"},await b(t,"opportunities",e);try{const r=st(e,n,i,s),c=URL.createObjectURL(r),l=document.createElement("a");if(l.href=c,l.download=`JobFlow-${n}-${e.company}.ics`,l.click(),URL.revokeObjectURL(c),window.open(at(e,n,i,s),"_blank"),"Notification"in window&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"){const d=i.getTime()-3e5-Date.now();d>0&&d<6*3600*1e3&&setTimeout(()=>{try{new Notification(`Start ${n}: ${e.company} â€” ${e.role}`,{body:"Timebox is about to start"})}catch{}},d)}}catch{}T()});document.addEventListener("keydown",t=>{var n,o,s;const e=document.getElementById("triage-modal");!e||!e.classList.contains("show")||(t.key==="Escape"&&(t.preventDefault(),T()),t.key.toLowerCase()==="r"&&(t.preventDefault(),(n=document.getElementById("triage-reject"))==null||n.click()),t.key.toLowerCase()==="a"&&(t.preventDefault(),(o=document.getElementById("triage-accept"))==null||o.click()),(t.key.toLowerCase()==="p"||t.key.toLowerCase()==="s")&&(t.preventDefault(),(s=document.getElementById("triage-plan"))==null||s.click()))});function it(t,e){var r,c;const n=[],o=Number(((r=e==null?void 0:e.gates)==null?void 0:r.min_fit)||70),s=Number(((c=e==null?void 0:e.gates)==null?void 0:c.min_energy)||7),a=Number(t.total_fit||t.fit_score||0),i=Number(t.energy_score||0);return(t.barriers||[]).length&&n.push("barrier"),a<o&&n.push(`fit ${a}% < ${o}%`),i<s&&n.push(`energy ${i} < ${s}`),n}async function K(t){var r,c,l;const e=document.getElementById("discovery-list");if(!e)return;const n=await h(),o=await v(n,"profile","profile"),s=(r=document.getElementById("discovery-show-all"))==null?void 0:r.checked;Number(((c=o==null?void 0:o.gates)==null?void 0:c.min_fit)||70),Number(((l=o==null?void 0:o.gates)==null?void 0:l.min_energy)||7);const a=(t||[]).slice().sort((u,m)=>Number(m.total_fit||m.fit_score||0)-Number(u.total_fit||u.fit_score||0)),i=[];for(const u of a){const m=Number(u.total_fit||u.fit_score||0),d=Number(u.energy_score||0),y=it(u,o),_=!y.length;!s&&!_||i.push(`<div class="row" style="justify-content:space-between; align-items:center; gap:8px;">
        <div><strong>${u.company||""}</strong> â€” ${u.role||""}</div>
        <div class="muted">Fit ${m||"-"}% â€¢ Energy ${d||"-"}/10${u.honesty_label?" â€¢ "+u.honesty_label:""}</div>
        ${_?"":`<div class="row" style="gap:6px;">${y.map(g=>`<span class="badge" style="color:#f59e0b;">${g}</span>`).join("")}</div>`}
        <div><button class="btn" data-id="${u.id}" data-act="triage">Triage</button></div>
      </div>`)}e.innerHTML=i.join("")||'<div class="muted">No roles match your gates. Toggle Show all.</div>'}var ye;(ye=document.getElementById("discovery-refresh"))==null||ye.addEventListener("click",async()=>{const t=await h(),e=await E(t,"opportunities");await K(e)});var ge;(ge=document.getElementById("discovery-show-all"))==null||ge.addEventListener("change",async()=>{const t=await h(),e=await E(t,"opportunities");await K(e)});var we;(we=document.getElementById("discovery-list"))==null||we.addEventListener("click",t=>{const e=t.target.closest('button[data-act="triage"]');if(!e)return;const n=Number(e.getAttribute("data-id"));n&&Le(n)});var he;(he=document.getElementById("today-open"))==null||he.addEventListener("click",async()=>{var i;const t=await h(),e=await E(t,"opportunities"),n=new Date;n.setHours(0,0,0,0);const o=n.getTime()+24*3600*1e3,s=e.filter(r=>{const c=r.next_action;if(!(c!=null&&c.planned_at))return!1;const l=new Date(c.planned_at).getTime();return l>=n.getTime()&&l<o}),a=document.getElementById("today-body");a.innerHTML=s.length?s.map(r=>`<div class="row" style="justify-content:space-between;"><span>${r.company} â€” ${r.role}</span><span class="muted">${r.next_action.type}, ${r.next_action.durationMin}m @ ${new Date(r.next_action.planned_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</span></div>`).join(""):'<div class="muted">No sessions planned for today</div>',document.getElementById("today-timer").style.display="none",document.getElementById("today-reflect").style.display="none",document.getElementById("today-start").style.display="",document.getElementById("today-complete").style.display="none",(i=document.getElementById("today-modal"))==null||i.classList.add("show")});var _e;(_e=document.getElementById("today-close"))==null||_e.addEventListener("click",()=>{var t;(t=document.getElementById("today-modal"))==null||t.classList.remove("show")});let N=null,G=0,xe=null;var be;(be=document.getElementById("today-start"))==null||be.addEventListener("click",async()=>{const t=await h(),n=(await E(t,"opportunities")).find(a=>{var i;return(i=a.next_action)==null?void 0:i.planned_at});if(!n)return;const o=Number(n.next_action.durationMin)||25;xe=n.id,G=Date.now()+o*6e4;const s=document.getElementById("today-timer");s.style.display="",document.getElementById("today-reflect").style.display="none",document.getElementById("today-start").style.display="none",document.getElementById("today-complete").style.display="",N&&clearInterval(N),N=setInterval(()=>{const a=Math.max(0,G-Date.now()),i=Math.floor(a/6e4),r=Math.floor(a%6e4/1e3);s.textContent=`Session running â€” ${i}:${String(r).padStart(2,"0")}`,a<=0&&(clearInterval(N),N=null,s.textContent="Session complete â€” jot 2 lines",document.getElementById("today-reflect").style.display="")},250)});var ve;(ve=document.getElementById("today-complete"))==null||ve.addEventListener("click",async()=>{var s,a,i,r,c;const t=await h(),e=await v(t,"opportunities",xe);if(!e)return;const n=document.getElementById("today-reflect").value||"",o=Array.isArray(e.sessions)?e.sessions:[];o.push({planned_at:(s=e.next_action)==null?void 0:s.planned_at,started_at:new Date(G-(Number((a=e.next_action)==null?void 0:a.durationMin)||25)*6e4).toISOString(),ended_at:new Date().toISOString(),type:((i=e.next_action)==null?void 0:i.type)||"apply",durationMin:Number((r=e.next_action)==null?void 0:r.durationMin)||25,outcome:"done",note:n}),e.sessions=o,delete e.next_action,await b(t,"opportunities",e),(c=document.getElementById("today-modal"))==null||c.classList.remove("show"),await S()});var Ee;(Ee=document.getElementById("gated-toggle"))==null||Ee.addEventListener("click",async()=>{const t=await h(),e=await v(t,"user_preferences","gated"),n=!((e==null?void 0:e.value)??!0);await b(t,"user_preferences",{key:"gated",value:n}),await S()});let f={step:1,rows:[],header:[],fileName:"",mapping:{},items:[],duplicates:[],newbies:[],selectedIds:new Set,invalids:[]};const Z={key:"profile",work_style:{comm:6,pace:7,feedback:6,collab:6},gates:{min_fit:70,min_energy:7},skills:["product","strategy","go-to-market","growth","ecosystem"]};async function rt(){const t=await h(),e=await v(t,"profile","profile");return e||(await b(t,"profile",{...Z}),{...Z})}function ct(t){const e=document.getElementById("csv-modal"),n=document.getElementById("csvm-step");document.getElementById("csvm-body");const o=document.getElementById("csvm-error"),s=document.getElementById("csvm-back"),a=document.getElementById("csvm-next"),i=document.getElementById("csvm-import");Object.assign(f,{step:1,rows:[],header:[],fileName:t.name,mapping:{},items:[],duplicates:[],newbies:[],selectedIds:new Set}),o.textContent="",t.text().then(r=>{const c=ot(r).filter(l=>l.some(u=>(u||"").trim()!==""));if(!c.length){o.textContent="Empty CSV";return}f.rows=c,f.header=c[0].map(l=>String(l||"").trim()),f.mapping=lt(f.header),X(),n.textContent="Step 1 of 3 â€” Map headers",s.disabled=!0,a.style.display="",i.style.display="none",e.classList.add("show")}).catch(r=>{o.textContent="Failed to read file: "+((r==null?void 0:r.message)||r)}),document.getElementById("csvm-cancel").onclick=Be,s.onclick=()=>{f.step>1&&(f.step--,f.step===1&&X(),f.step===2&&ee(),H())},a.onclick=async()=>{if(f.step===1){const r=dt();if(!r.ok){o.textContent=r.msg;return}o.textContent="",await ut(),f.step=2,ee(),H()}else f.step===2&&(f.step=3,mt(),H())},i.onclick=()=>pt()}function Be(){document.getElementById("csv-modal").classList.remove("show")}function H(){const t=document.getElementById("csvm-step"),e=document.getElementById("csvm-back"),n=document.getElementById("csvm-next"),o=document.getElementById("csvm-import"),s=document.getElementById("csvm-error");s.textContent="",f.step===1?(t.textContent="Step 1 of 3 â€” Map headers",e.disabled=!0,n.style.display="",o.style.display="none"):f.step===2?(t.textContent="Step 2 of 3 â€” Preview & dedupe",e.disabled=!1,n.style.display="",o.style.display="none"):(t.textContent="Step 3 of 3 â€” Confirm import",e.disabled=!1,n.style.display="none",o.style.display="")}function lt(t){const e=t.map(o=>o.toLowerCase()),n={};for(const[o,s]of Object.entries(Ue)){let a=-1;for(const i of s){const r=e.indexOf(i.toLowerCase());if(r!==-1){a=r;break}}a!==-1&&(n[o]=t[a])}return n}function dt(){const t=["company","role","job_url"],e=f.mapping,n=t.filter(a=>!e[a]);if(n.length)return{ok:!1,msg:"Missing mappings: "+n.join(", ")};const o=Object.values(e),s=o.find((a,i)=>o.indexOf(a)!==i);return s?{ok:!1,msg:"Duplicate column selected: "+s}:{ok:!0}}function X(){const t=document.getElementById("csvm-body"),e=f.header,n=["company","role","job_url"],o=["status","priority_score","fit_score","fit_flag","deadline","posted_at","location","segment","applicant_volume","interest_score","notes"],s=p("div",{},p("div",{class:"muted",style:"margin-bottom:8px;"},`File: ${f.fileName}`),p("div",{class:"muted",style:"margin-bottom:8px;"},"Map your CSV columns. Required first; optional help scoring and analytics."),...n.map(a=>p("div",{class:"row",style:"gap:8px; margin-bottom:6px; align-items:center;"},p("div",{style:"width:180px;"},a),(()=>{const r=p("select",{id:`map-${a}`});return r.append(p("option",{value:""},"-- Select column --")),e.forEach(c=>r.append(p("option",{value:c,selected:f.mapping[a]===c},c))),r.addEventListener("change",()=>{f.mapping[a]=r.value||void 0}),r})())),p("div",{class:"muted",style:"margin:8px 0 4px 0;"},"Optional"),...o.map(a=>p("div",{class:"row",style:"gap:8px; margin-bottom:6px; align-items:center;"},p("div",{style:"width:180px;"},a),(()=>{const r=p("select",{id:`map-${a}`});return r.append(p("option",{value:""},"-- None --")),e.forEach(c=>r.append(p("option",{value:c,selected:f.mapping[a]===c},c))),r.addEventListener("change",()=>{r.value?f.mapping[a]=r.value:delete f.mapping[a]}),r})())));t.innerHTML="",t.append(s)}async function ut(){const t=f.header,e=Object.fromEntries(t.map((d,y)=>[d,y])),n=f.mapping,s=f.rows.slice(1).map(d=>{const y=n.fit_flag?(d[e[n.fit_flag]]||"").trim():"",_=n.fit_score?Number(d[e[n.fit_score]]||0)||0:void 0,g=Number.isFinite(_)&&_>0?_:_t(y),L=n.priority_score&&Number(d[e[n.priority_score]]||0)||0,B=wt(n.location?(d[e[n.location]]||"").trim():""),j=ht(n.segment?(d[e[n.segment]]||"").trim():""),q=n.posted_at?(d[e[n.posted_at]]||"").trim():"",F=n.applicant_volume&&Number(d[e[n.applicant_volume]]||0)||0,$e=n.interest_score?Number(d[e[n.interest_score]]||0)||0:bt(F),Ne=n.deadline?(d[e[n.deadline]]||"").trim():"";return{company:(d[e[n.company]]||"").trim(),role:(d[e[n.role]]||"").trim(),job_url:(d[e[n.job_url]]||"").trim(),status:(n.status?(d[e[n.status]]||"").trim():"research")||"research",priority_score:L||g||0,fit_score:g||0,deadline:Ne,posted_at:q,location:B,segment:j,applicant_volume:F,interest_score:$e,notes:n.notes?(d[e[n.notes]]||"").trim():""}}).filter(d=>d.company&&d.role),a=await h(),i=await E(a,"opportunities"),r=new Set(i.map(d=>d.hash)),c=s.map(d=>({...d,_hash:Ie([d.company,d.role,d.job_url].join("|").toLowerCase())})),l=c.filter(d=>!gt(d.job_url)),u=c.filter(d=>!r.has(d._hash)),m=c.filter(d=>r.has(d._hash));f.items=c,f.newbies=u,f.duplicates=m,f.invalids=l,f.selectedIds=new Set(u.map((d,y)=>String(y)))}function ee(){const t=document.getElementById("csvm-body"),e=p("div",{},p("div",{class:"muted",style:"margin-bottom:8px;"},`${f.newbies.length} new â€¢ ${f.duplicates.length} duplicates (skipped) â€¢ ${f.invalids.length} invalid links`)),n=p("div",{});f.items.slice(0,Math.max(10,f.items.length)).forEach((s,a)=>{const i=f.duplicates.includes(s),r=f.invalids.includes(s),c=f.items.indexOf(s),l=String(c),u=!i&&!r&&f.selectedIds.has(l),m=p("div",{class:"cardk",style:"display:flex; align-items:center; gap:8px;"},p("input",{type:"checkbox",disabled:i||r,checked:u,onchange:d=>{d.target.checked?f.selectedIds.add(l):f.selectedIds.delete(l)}}),p("div",{class:"title"},`${s.company} â€” ${s.role}`),p("div",{class:"muted",style:"margin-left:auto;"},r?"Invalid link":i?"Duplicate":"New"));n.append(m)}),e.append(n),t.innerHTML="",t.append(e)}function mt(){const t=document.getElementById("csvm-body"),e=Array.from(f.selectedIds).length;t.innerHTML="",t.append(p("div",{class:"muted",style:"margin-bottom:8px;"},`${e} rows ready to import. Duplicates will be skipped automatically.`))}async function pt(){const t=document.getElementById("import-result"),e=Array.from(f.selectedIds).map(i=>f.items[Number(i)]).filter(Boolean),n=await rt();let o;try{o=await Ae(()=>import("./scoring-DZOqtRTd.js"),[],import.meta.url)}catch{}const s=e.map(i=>{const c={id:crypto.randomUUID(),company:i.company,role:i.role,job_url:i.job_url,status:i.status||"research",deadline:i.deadline||"",posted_at:i.posted_at||"",location:i.location||"",segment:i.segment||"",applicant_volume:i.applicant_volume||0,interest_score:i.interest_score||0,notes:i.notes||"",hash:i._hash,created_at:Date.now()};let l={};try{const u=o!=null&&o.detectBarriers?o.detectBarriers(c):[],m=o!=null&&o.computeScores?o.computeScores(c,n):{total:70,energy:7,cultureDims:{comm:6,pace:6,feedback:6,collab:6}},d=o!=null&&o.honestyLabel?o.honestyLabel(m,u):{label:"Long Shot",why:[]};l={base_score:m.base||0,culture_score:m.culture||0,timing_score:m.timing||0,alumni_score:m.alumni||0,work_style_score:m.workstyle||0,total_fit:m.total||0,energy_score:m.energy||0,culture_dims:m.cultureDims||{},honesty_label:d.label,honesty_evidence:d.why||[],barriers:u}}catch{}return{...c,...l}}),a=await h();if(s.length){await M(a,"opportunities",s);const i=await A(a);for(const r of I)i[r.id]||(i[r.id]={column_id:r.id,opportunity_ids:[]});for(const r of s)i[r.status].opportunity_ids=[r.id,...i[r.status].opportunity_ids];await R(a,i)}Be(),t&&(t.textContent=`Imported ${s.length} new, skipped ${f.items.length-s.length}.`),await S(),J("kanban")}const ft=["boards.greenhouse.io","greenhouse.io","jobs.ashbyhq.com","ashbyhq.com","jobs.lever.co","lever.co","myworkdayjobs.com","workday.com","smartrecruiters.com","careers.smartrecruiters.com","jobvite.com","icims.com"],yt=["linkedin.com/jobs","indeed.com","glassdoor.com","ziprecruiter.com","levels.fyi","wellfound.com","angel.co","himalayas.app","remotive.com","weworkremotely.com","remoteok.com","workingnomads.com","jobicy.com"];function gt(t){try{const e=new URL(t);return yt.some(n=>e.host.includes(n)||e.href.includes(n))?!1:ft.some(n=>e.host.endsWith(n))?!0:/\/careers|\/jobs|\/careers\//i.test(e.pathname)}catch{return!1}}function wt(t){const e=(t||"").toLowerCase();return e?e.includes("remote")?"Remote":e.includes("new york")||e.includes("nyc")?"NYC":e.includes("hybrid")?"Hybrid":t:""}function ht(t){const e=(t||"").toLowerCase();return e.includes("ai")?"Applied AI":e.includes("health")?"HealthTech":e.includes("ecosystem")||e.includes("partner")?"Ecosystem/Partnerships":e.includes("innovation")||e.includes("new venture")?"Corporate Innovation":e.includes("saas")||e.includes("productivity")||e.includes("plg")?"SaaS Productivity":t}function _t(t){const e=(t||"").toLowerCase();return e?e.includes("strong")?90:e.includes("good")||e.includes("solid")?80:e.includes("stretch")||e.includes("maybe")?65:e.includes("poor")||e.includes("low")?40:0:0}function bt(t){const e=Number(t)||0;return e<=0?0:e<20?30:e<100?55:e<300?70:85}async function vt(){try{const t=await h(),e=await v(t,"user_preferences","stages"),n=Array.isArray(e==null?void 0:e.value)?e.value:null;n&&n.length&&(I=n.map(o=>({id:je(o.id||o.name),name:o.name||o.id})))}catch{}}async function Et(t){var r;const e=await h(),n=t.map(c=>({id:je(c),name:c}));await b(e,"user_preferences",{key:"stages",value:n}),I=n;const o=await E(e,"opportunities"),s=new Set(I.map(c=>c.id));for(const c of o)s.has(c.status)||(c.status=((r=I[0])==null?void 0:r.id)||"research",await b(e,"opportunities",c));const a={};for(const c of I)a[c.id]={column_id:c.id,opportunity_ids:[]};const i=await E(e,"opportunities");for(const c of i)a[c.status]||(a[c.status]={column_id:c.status,opportunity_ids:[]}),a[c.status].opportunity_ids.push(c.id);await M(e,"kanban_state",Object.values(a))}function je(t){return String(t||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||"stage"}
